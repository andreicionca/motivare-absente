<!DOCTYPE html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Motivări Școlare</title>
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="icon" type="image/png" href="/favicon.png" />
  </head>
  <body>
    <!-- Top Header -->
    <header class="top-header">
      <div class="user-info">
        <div class="avatar">
          <span id="user-avatar">👤</span>
        </div>
        <div class="user-details">
          <h2 id="user-name">Nume Utilizator</h2>
          <p id="user-role">Elev • Clasa 10A</p>
        </div>
      </div>
      <button class="logout-btn" onclick="auth.logout()">Ieșire</button>
    </header>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Main Content Container -->
    <main class="main-content">
      <!-- Pagina 1: Dashboard/Stats -->
      <section class="page-content active" id="page-stats">
        <div class="page-header">
          <h2>📊 Statistici</h2>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card primary">
            <div class="stat-icon">⏰</div>
            <div class="stat-info">
              <h3 id="ore-ramase">42</h3>
              <p>Ore personale rămase</p>
            </div>
          </div>

          <div class="stat-card success">
            <div class="stat-icon">✅</div>
            <div class="stat-info">
              <h3 id="absente-motivate">0</h3>
              <p>Absențe motivate</p>
            </div>
          </div>

          <div class="stat-card warning">
            <div class="stat-icon">📄</div>
            <div class="stat-info">
              <h3 id="total-motivari">0</h3>
              <p>Total motivări</p>
            </div>
          </div>

          <div class="stat-card info">
            <div class="stat-icon">⏳</div>
            <div class="stat-info">
              <h3 id="in-asteptare">0</h3>
              <p>În așteptare</p>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="recent-activity">
          <h3>Activitate Recentă</h3>
          <div class="activity-list" id="recent-activity">
            <!-- Se încarcă dinamic -->
          </div>
        </div>
      </section>

      <!-- Pagina 2: Încarcă Motivare -->
      <section class="page-content" id="page-upload">
        <div class="page-header">
          <h2>📤 Încarcă Motivare</h2>
        </div>

        <!-- Tipuri Motivări -->
        <div class="motivare-types">
          <button class="type-card" onclick="selectMotivareType('medicala_clasica')">
            <div class="type-icon">🏥</div>
            <h3>Motivare medicală</h3>
            <p>Pentru zilele de boală</p>
          </button>

          <button
            class="type-card"
            onclick="selectMotivareType('invoire_lunga')"
            id="invoire-lunga-card"
          >
            <div class="type-icon">📅</div>
            <h3>Învoire de la părinte</h3>
            <p>Pentru una sau mai multe zile de școală</p>
          </button>

          <button class="type-card" onclick="selectMotivareType('alte_motive')">
            <div class="type-icon">📋</div>
            <h3>Alte motive</h3>
            <p>Situații speciale</p>
          </button>
        </div>

        <!-- Formular Motivare -->
        <form class="motivare-form" id="motivare-form" style="display: none">
          <input type="hidden" id="tip-motivare" name="tip_motivare" />

          <div class="form-group">
            <label>Atașează documentul</label>
            <div class="upload-area" id="upload-area">
              <div class="upload-placeholder">
                <span class="upload-icon">📷</span>
                <p>Fotografiază sau alege din galerie</p>
              </div>
              <input type="file" id="file-input" accept="image/*" />
              <div class="upload-buttons">
                <button type="button" class="upload-btn" onclick="openCamera()">📷 Cameră</button>
                <button type="button" class="upload-btn" onclick="openGallery()">🖼️ Galerie</button>
              </div>
            </div>

            <!-- Image Preview Container -->
            <div class="image-preview-container" id="image-preview-container" style="display: none">
              <div class="image-preview-header">
                <span>Document atașat</span>
                <div class="image-controls">
                  <button
                    type="button"
                    class="rotate-btn"
                    onclick="rotateImage(-90)"
                    title="Rotește stânga"
                  >
                    ↺
                  </button>
                  <button
                    type="button"
                    class="rotate-btn"
                    onclick="rotateImage(90)"
                    title="Rotește dreapta"
                  >
                    ↻
                  </button>
                  <button type="button" class="remove-image-btn" onclick="removeImage()">×</button>
                </div>
              </div>
              <div class="image-preview-wrapper">
                <img id="preview-img" src="" alt="Preview document" />
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="perioada-inceput">Data început</label>
            <input type="date" id="perioada-inceput" name="perioada_inceput" required />
          </div>

          <div class="form-group" id="perioada-sfarsit-group">
            <label for="perioada-sfarsit">Data sfârșit</label>
            <input type="date" id="perioada-sfarsit" name="perioada_sfarsit" />
          </div>

          <div class="form-group">
            <label for="motiv">Motivul (opțional)</label>
            <textarea id="motiv" name="motiv" placeholder="Descrie motivul absenței..."></textarea>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="resetForm()">Anulează</button>
            <button type="submit" class="btn btn-primary">Trimite Motivarea</button>
          </div>
        </form>
      </section>

      <!-- Pagina 3: Solicit Învoire -->
      <section class="page-content" id="page-cereri">
        <div class="page-header">
          <h2>⚡ Solicit învoire de la școală pentru câteva ore</h2>
        </div>

        <!-- Tipuri Cereri -->
        <div class="cereri-types">
          <button class="type-card" onclick="selectCerereType('personal')">
            <div class="type-icon">👤</div>
            <h3>Învoire personală</h3>
            <p>Se scade din limita de 42 ore/an</p>
          </button>

          <button class="type-card" onclick="selectCerereType('invoire_justificata')">
            <div class="type-icon">📋</div>
            <h3>Învoire justificată</h3>
            <p>Nu se scade din limita anuală</p>
          </button>
        </div>

        <!-- Formular Cerere -->
        <form class="cerere-form" id="cerere-form" style="display: none">
          <input type="hidden" id="tip-cerere" name="tip_cerere" />

          <div class="form-group">
            <label for="data-solicitata">Data solicitată</label>
            <input type="date" id="data-solicitata" name="data_solicitata" required />
          </div>

          <div class="form-group">
            <label for="ora-inceput">Ora început</label>
            <input type="time" id="ora-inceput" name="ora_inceput" required />
          </div>

          <div class="form-group">
            <label for="ora-sfarsit">Ora sfârșit</label>
            <input type="time" id="ora-sfarsit" name="ora_sfarsit" required />
          </div>

          <div class="form-group">
            <label for="motiv-cerere">Motivul</label>
            <textarea
              id="motiv-cerere"
              name="motiv"
              placeholder="Descrie motivul invoirii..."
              required
            ></textarea>
          </div>

          <div class="cerere-info">
            <p id="cerere-info-text">Cererea va fi trimisă părintelui pentru aprobare.</p>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="resetCerereForm()">
              Anulează
            </button>
            <button type="submit" class="btn btn-primary">Trimite Cererea</button>
          </div>
        </form>
      </section>

      <!-- Pagina 4: Motivările Mele -->
      <section class="page-content" id="page-motivari">
        <div class="page-header">
          <h2>📄 Motivările Mele</h2>
          <button class="refresh-btn" onclick="loadMotivari()">🔄</button>
        </div>

        <!-- Filtre -->
        <div class="filters">
          <button class="filter-btn active" data-filter="toate">Toate</button>
          <button class="filter-btn" data-filter="in_asteptare">În așteptare</button>
          <button class="filter-btn" data-filter="aprobata">Aprobate</button>
          <button class="filter-btn" data-filter="finalizata">Motivate</button>
          <button class="filter-btn" data-filter="respinsa">Respinse</button>
        </div>

        <!-- Lista Motivări -->
        <div class="motivari-list" id="motivari-list">
          <!-- Se încarcă dinamic -->
          <div class="empty-state" id="motivari-empty">
            <div class="empty-icon">📝</div>
            <p>Nu ai motivări</p>
          </div>
        </div>
      </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <button class="nav-item active" data-page="stats">
        <span class="nav-icon">📊</span>
        <span class="nav-label">Statistici</span>
      </button>

      <button class="nav-item" data-page="upload">
        <span class="nav-icon">📤</span>
        <span class="nav-label">Încarcă</span>
      </button>

      <button class="nav-item" data-page="cereri">
        <span class="nav-icon">⚡</span>
        <span class="nav-label">Solicit</span>
      </button>

      <button class="nav-item" data-page="motivari">
        <span class="nav-icon">📄</span>
        <span class="nav-label">Motivările mele</span>
      </button>
    </nav>

    <!-- Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
  </body>
</html>
